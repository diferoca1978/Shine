---
import { getCollection } from "astro:content";
import BlogLayout from "@/layouts/BlogLayout.astro";
import BlogCard from "@/components/ui/BlogCard.astro";

const posts = await getCollection("blog", ({ data }) => !data.draft);

const recentPosts = posts
  .sort(
    (a, b) =>
      new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime(),
  )
  .slice(0, 4);

const formatDate = (date: Date): string =>
  new Date(date).toLocaleDateString("es-CO", {
    day: "numeric",
    month: "short",
    year: "numeric",
  });
---

<BlogLayout
  title="Blog"
  description="Aquí encontrarás todos los posts publicados por Shine Agencia."
>
  <section class="container w-full mx-auto">
    <div class="blog-wrapper max-w-7xl mx-auto px-4 py-8 md:py-16 lg:py-20">
      <div id="blog-header" class="flex flex-col items-center gap-2">
        <h1
          class="text-[min(10vw,72px)] font-playfair font-medium text-smokyBlack dark:text-softWhite leading-tight tracking-tight mb-4"
        >
          Shine Blog
        </h1>
        <p
          class="text-[min(5vw,24px)] text-center font-openSans text-smokyBlack dark:text-softWhite mb-8 max-w-2xl mx-auto"
        >
          Inspiración y conocimiento para impulsar tu negocio digital.
        </p>
      </div>
      <div class="blog-grid grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
        {
          recentPosts.map((post) => (
            <BlogCard
              slug={post.data.slug}
              title={post.data.title}
              author={post.data.author}
              publishDate={formatDate(post.data.pubDate)}
              description={post.data.description}
              image={post.data.image.src}
              tags={post.data.tags}
            />
          ))
        }
      </div>
    </div>
  </section>
</BlogLayout>
