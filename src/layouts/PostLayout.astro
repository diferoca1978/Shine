---
import MainLayout from "@/layouts/MainLayout.astro";
import {
    generateBreadcrumbSchema,
    generateBlogPostSchema,
    type JSONLDSchema,
} from "@/config/seo";
import type { Author } from "@/config/authors";

interface Props {
    title: string;
    description: string;
    publishDate: Date;
    modifiedDate?: Date;
    image?: string;
    slug: string;
    author?: Author;
}

const { title, description, publishDate, modifiedDate, image, slug, author } = Astro.props;

// Sanitize slug: trim whitespace and ensure it's URL-safe
const sanitizedSlug = slug.trim().replace(/\s+/g, '-').toLowerCase();

// Generate specific schemas for the post
const postSchema = generateBlogPostSchema({
    title,
    description,
    publishDate,
    modifiedDate,
    image,
    id: sanitizedSlug,
    author: author ? {
        name: author.name,
        role: author.role,
        url: author.url,
        credentials: author.credentials,
    } : undefined,
});

const breadcrumbSchema = generateBreadcrumbSchema([
    { name: "Inicio", url: "/" },
    { name: "Blog", url: "/blog" },
    { name: title, url: `/blog/${sanitizedSlug}` },
]);

const aditionalSchemas: JSONLDSchema[] = [postSchema, breadcrumbSchema];
---

<MainLayout
    title={title}
    description={description}
    path={`/blog/${sanitizedSlug}`}
    image={image}
    aditionalSchemas={aditionalSchemas}
>
    <slot />
</MainLayout>
